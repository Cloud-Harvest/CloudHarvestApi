report:
  description: Generates a list of all API nodes and Agents
  headers:
    - Active
    - Hostname
    - IP
    - Version
    - Start
    - Last

  tasks:
    - redis:
        name: Retrieve information on Harvest nodes
        description: Get the API nodes
        result_as: api_nodes
        db:
          alias: ephemeral
          database: agent

    - redis:
        name: Retrieve information on Harvest agents
        description: Get the agents
        result_as: agents
        db:
          alias: ephemeral
          database: agent

    - recordset:
        name: Generate the consolidated report
        data: var.api_nodes
        user_filters:
          accepted: '*'
        stages:
          - add:
              data: var.agents
